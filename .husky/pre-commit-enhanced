#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "🚀 Pre-commit checks starting..."

# Run lint-staged for automatic fixes
echo "📝 Running automatic fixes on staged files..."
npx lint-staged

# Check if there are any remaining issues
echo "🔍 Running comprehensive quality checks..."

# Run type check on entire project
echo "🔧 TypeScript type checking..."
if ! npm run type-check; then
  echo "❌ Type check failed. Please fix TypeScript errors before committing."
  exit 1
fi

# Run all tests
echo "🧪 Running tests..."
if ! npm test -- --passWithNoTests; then
  echo "❌ Tests failed. Please fix failing tests before committing."
  exit 1
fi

# Run lint check (read-only)
echo "🔍 Final lint check..."
if ! npm run lint; then
  echo "❌ Lint issues found. Please run 'npm run lint:fix' to resolve."
  exit 1
fi

echo "✅ All pre-commit checks passed!"
echo "🎉 Ready to commit!"
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Pre-commit checks starting..."

# Run lint-staged for automatic fixes
echo "ğŸ“ Running automatic fixes on staged files..."
npx lint-staged

# Check if there are any remaining issues
echo "ğŸ” Running comprehensive quality checks..."

# Run type check on entire project
echo "ğŸ”§ TypeScript type checking..."
if ! npm run type-check; then
  echo "âŒ Type check failed. Please fix TypeScript errors before committing."
  exit 1
fi

# Run all tests
echo "ğŸ§ª Running tests..."
if ! npm test -- --passWithNoTests; then
  echo "âŒ Tests failed. Please fix failing tests before committing."
  exit 1
fi

# Run lint check (read-only)
echo "ğŸ” Final lint check..."
if ! npm run lint; then
  echo "âŒ Lint issues found. Please run 'npm run lint:fix' to resolve."
  exit 1
fi

echo "âœ… All pre-commit checks passed!"
echo "ğŸ‰ Ready to commit!"
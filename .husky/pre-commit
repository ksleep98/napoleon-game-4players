
echo "ğŸš€ Pre-commit checks starting..."

# Check if committing to develop branch (must be first check)
current_branch=$(git rev-parse --abbrev-ref HEAD)
if [ "$current_branch" = "develop" ]; then
    echo ""
    echo "âŒ Error: Direct commits to develop branch are not allowed"
    echo ""
    echo "ğŸ”§ To fix this:"
    echo "  1. Create a feature branch: git checkout -b feature/your-feature-name"
    echo "  2. Or switch to existing branch: git checkout your-branch-name"
    echo ""
    echo "ğŸ“ Current staged changes will be preserved when you switch branches"
    echo ""
    exit 1
fi

# Run lint-staged for automatic fixes
echo "ğŸ“ Running automatic fixes on staged files..."
npx lint-staged

# Additional comprehensive checks
echo "ğŸ” Running comprehensive quality checks..."

# Run type check on entire project
echo "ğŸ”§ TypeScript type checking..."
if ! pnpm type-check; then
  echo "âŒ Type check failed. Please fix TypeScript errors before committing."
  exit 1
fi

# Run all tests with consistent environment variables (same as CI)
echo "ğŸ§ª Running tests..."
if ! pnpm test:ci; then
  echo "âŒ Tests failed. Please fix failing tests before committing."
  exit 1
fi

echo "âœ… All pre-commit checks passed!"
echo "ğŸ‰ Ready to commit!"
